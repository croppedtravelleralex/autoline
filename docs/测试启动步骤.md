# AutoLine 项目测试启动步骤

本项目采用前后端完全分离的架构。后端基于 Python FastAPI，前端基于 React + TypeScript。

## 1. 后端启动 (Backend)

后端代码位于 `backend` 目录下。

### 环境准备
- Python 3.10+
- 推荐使用虚拟环境 (venv)

### 启动步骤
1. 打开终端，进入 `backend` 目录。
2. (可选) 创建并激活虚拟环境：
   ```powershell
   python -m venv venv
   .\venv\Scripts\activate
   ```
3. 安装依赖：
   ```powershell
   pip install -r requirements.txt
   ```
4. 运行后端服务：
   ```powershell
   python main.py
   ```
   *服务将运行在: `http://localhost:8000`*
   *API 文档地址: `http://localhost:8000/docs`*

---

## 2. 前端启动 (Frontend)

前端代码位于 `frontend` 目录下。

### 环境准备
- Node.js (建议 v18+)
- npm 或 yarn

### 启动步骤
1. 打开另一个终端，进入 `frontend` 目录。
2. 安装依赖：
   ```powershell
   npm install
   ```
3. 启动开发服务器：
   ```powershell
   npm run dev
   ```
   *服务通常运行在: `http://localhost:5173` 或 `http://localhost:5174`*

---

## 3. 测试与验证

### 自动连接验证
1. 确保后端服务正常运行（控制台无错误输出）。
2. 在浏览器打开前端页面。
3. 检查控制台（F12）或页面上的系统状态，确认是否能够获取到实时数据。

### 通讯测试
- 前端会向后端 `http://localhost:8000/api/state` 发起请求。
- 如果出现跨域问题，请检查 `backend/main.py` 中的 `allow_origins` 配置。

---

## 4. 常见问题 (FAQ)

- **Q: 后端无法启动，提示端口占用？**
  - A: 请检查是否有其他进程占用了 8000 端口，或者在 `main.py` 中修改端口号。
- **Q: 前端无法连接后端 API？**
  - A: 请确保后端控制台显示服务已就绪，并且前端 `api.ts` 中的 `BASE_URL` 指向正确的后端地址。

---

## 5. 实测启动记录 (2026-01-18)

### 后端启动实录
在 Windows 环境下，系统默认 `python` 命令可能不可用。本次启动使用了 Anaconda 环境下的 python 执行程序。

1. **定位 Python 路径**:
   由于默认 `python` 命令报错，通过查找找到可用解释器：
   ```powershell
   CMD: where python
   # 结果中包含可用路径: C:\software\annnaconda\python.exe
   ```

2. **创建虚拟环境**:
   使用指定路径的 Python 创建 venv：
   ```powershell
   cd backend
   C:\software\annnaconda\python.exe -m venv venv
   ```

3. **激活并安装依赖**:
   ```powershell
   .\venv\Scripts\activate
   pip install -r requirements.txt
   ```

4. **启动服务**:
   ```powershell
   .\venv\Scripts\python main.py
   # 服务成功运行在 http://localhost:8000
   ```

### 前端启动实录
前端启动过程顺畅，未遇到特殊问题。

1. **安装依赖**:
   ```powershell
   cd frontend
   npm install
   ```
   *当前 npm 版本: 10.9.2*

2. **启动服务**:
   ```powershell
   npm run dev
   # 服务运行在 http://localhost:5173
   ```

---

## 6. 服务重启 (Restart Services)

当修改代码后，通常需要重启服务以使更改生效。

### 重启后端 (Backend)
1. 在运行后端的终端窗口中，按下 `Ctrl + C` 停止服务。
2. 再次执行启动命令：
   ```powershell
   python main.py
   # 或者如果使用虚拟环境:
   # .\venv\Scripts\python main.py
   ```

### 重启前端 (Frontend)
1. 在运行前端的终端窗口中，按下 `Ctrl + C` 停止服务（可能需要按两下）。
2. 再次执行启动命令：
   ```powershell
   npm run dev
   ```
   *注意：Vite 开发服务器通常支持热更新 (HMR)，修改组件代码后无需重启，页面会自动刷新。但修改 `vite.config.ts` 等配置文件通常需要重启。*

---

## 7. 检查与停止服务 (Check and Stop Services)

如果因为之前的终端窗口关闭，或者其他原因导致服务在后台运行而无法通过 Ctrl+C 停止，可以使用以下命令手动查找并结束进程。

### 检查端口占用
使用 `netstat` 命令查看端口使用情况：

__后端端口 (8000)__:
```powershell
netstat -ano | findstr :8000
```
__前端端口 (5173/5174)__:
```powershell
netstat -ano | findstr :5173
```

输出示例:
```text
  TCP    0.0.0.0:8000           0.0.0.0:0              LISTENING       12345
```
*(其中 `12345` 是进程 ID / PID)*

### 强制停止进程
获取到 PID 后，使用 `taskkill` 命令强制结束进程：

```powershell
taskkill /PID <PID> /F
```
例如：
```powershell
taskkill /PID 12345 /F
```

> **注意**: 
> - `/F` 参数表示强制终止。
> - Windows 下常见的 Python 进程名为 `python.exe`，前端 Node 进程名为 `node.exe`。
> - 如果遇到权限不足，请以**管理员身份**运行终端。
